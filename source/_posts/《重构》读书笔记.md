---
title: 《重构》读书笔记
date: 2018-11-27 23:33:16
tags: [js, 笔记]
categories: 读书笔记
---

## 重构，第一个实例

> 是需求的变化使重构变得必要。如果一段代码能正常工作，并且他不会再被修改，那么完全可以不去重构它。能改进之当然很好，但若没人需要去理解它，它就不会真正妨碍什么。如果确实有人需要理解它的工作原理，并且理解起来很费劲，那你就需要改进一下代码了。
> 要将我的理解转化到代码里，得先将这块代码抽取成一个独立的函数，按它所干的事情给它命名，每次想将一块代码抽取成一个函数时，我都会遵循一个标准流程，最大程度减少犯错的可能，这个流程命名为提炼函数。

- 分解 statement 函数
- 移除 play 临时变量，以查询取代
- 提炼计算观众量积分的逻辑
- 移除 format 变量 (将函数赋值为临时变量，改为一个明确的函数)
- 移除观众量积分总和 (提炼函数和应用内联变量) -> 这两部称为以查询取代临时变量？
- 拆分计算阶段和格式化阶段
- 分离为两个文件（两个阶段）
- 按类型重组计算过程，使用多态计算器来提供数据

## 重构的原则

### 何谓重构

使用一系列重构手法，在不改变软件可观察行为的前提下，调整其结构。它和性能优化不同，重构是为了让代码更容易理解，更易于修改，这可能使程序运行得更快，也可能使程序运行得更慢

### 两顶帽子

两顶帽子指添加新功能和重构，软件开发过程中经常变换帽子，但是无论何时都清楚自己戴的哪一顶帽子，并且明白不同的帽子对编程状态提出的不同要求

### 为何重构

- 重构改进软件的设计
- 重构使软件更容易理解
- 重构帮助找到 bug
- 重构提高编程速度

### 何时重构

第三次做类似的事情，你就应该重构

- 预备性重构：让添加新功能更容易
- 帮助理解的重构： 使代码更易懂
- 捡垃圾式重构（先记下来）
- 有计划重构和见机行事的重构

#### 长期重构

可以让整个团队达成共识，在未来几周时间里逐步解决这个问题，这经常是一个有效的策略

#### 复审代码时重构

与原作者肩并肩坐在一起，一边浏览代码一边重构，体验是最佳的。这种工作方式很自然地导向结对编程：在编程的过程中持续不断地进行代码复审

#### 怎么对经理说

不要告诉经理！

### 重构的挑战

#### 延缓新功能开发

重构的唯一目的就是让我们开发更快，用更少的
工作量创造更大的价值。

有些人试图用“整洁的代码”“良好的工程实践”之类
道德理由来论证重构的必要性，我认为这是个陷阱。重构的
意义不在于把代码库打磨得闪闪发光，而是纯粹经济角度出
发的考量。我们之所以重构，因为它能让我们更快——添加
功能更快，修复 bug 更快。
一定要随时记住这一点，与别人
交流时也要不断强调这一点。重构应该总是由经济利益驱
动。程序员、经理和客户越理解这一点，
“好的设计”那条
曲线就会越经常出现。

#### 代码所有权

#### 分支

#### 测试

#### 遗留代码

### 重构、架构和YAGNI

### 重构与软件开发过程

### 重构与性能

### 重构起源何处

### 自动化重构

IDE

## 代码的坏味道

> 你必须培养自己的判断力，学会判断一个类内有多少实例变量算是太大、一个函数内有多少行代码才算太长。

### 神秘命名 Mysterious Name

整洁代码最重要的一环就是好的名字

为一个恼人的名字所付出的纠结，常常能推动我们对代码进行精简。

### 重复代码 Duplicated Code

最单纯的重复代码就是“同一个类的两个函数含有相同的表达式”。这时候你需要做的就是采用提炼函数（106）提炼出重复的代码

如果重复代码只是相似而不是完全相同，请首先尝试用移动语句（223）重组代码顺序，把相似的部分放在一起以便提炼。如果重复的代码段位于同一个超类的不同子类中，可以使用函数上移（350）来避免在两个子类之间互相调用。

### 过长函数 Long Function

你应该更积极地分解函数。我们遵循这样一条原则：每当感觉需要以注释来说明点什么的时候，我们就把需要说明的东西写进一个独立函数中，并以其用途（而非实现手法）命名。我们可以对一组甚至短短一行代码做这件事。关键不在于函数的长度，而在于函数“做什么”和“如何做”之间的语义距离。

你可以经常运用以查询取代临时变量（178）来消除临时元素。引入参数对象（140）和保持对象完整（319）则可以将过长的参数列表变得更简洁一些。

条件表达式和循环常常也是提炼的信号。

### 过长的参数列表 Long Parameter List

如果可以向某个参数发起查询而获得另一个参数的值，那么就可以使用以查询取代参数（324）
如果你发现自己正在从现有的数据结构中抽出很多数据项，就可以考虑使用保持对象完整（319）手法
如果有几项参数总是同时出现，可以用引入参数对象（140）将其合并成一个对象
如果某个参数被用作区分函数行为的标记（flag），可以使用移除标记参数（314）
使用类可以有效地缩短参数列表。如果多个函数有同样的几个参数，引入一个类就尤为有意义。你可以使用函数组
合成类（144），将这些共同的参数变成这个类的字段